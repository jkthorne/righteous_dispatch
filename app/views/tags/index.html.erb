<% content_for :title, "Tags - RighteousDispatch" %>

<div class="max-w-2xl mx-auto">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-lg sm:text-xl font-bold">TAGS</h1>
      <p class="text-[10px] sm:text-xs text-base-content/60 mt-1">Organize subscribers and target newsletters</p>
    </div>
  </div>

  <!-- Create Tag Form -->
  <div class="border border-base-content/20 mb-6">
    <div class="bg-base-content/5 p-3 border-b border-base-content/20">
      <div class="text-[10px] sm:text-xs font-bold">CREATE TAG</div>
    </div>
    <div class="p-4">
      <%= form_with model: @tag, class: "flex items-end gap-3" do |f| %>
        <div class="flex-1">
          <label class="text-[10px] text-base-content/60 mb-1 block font-bold">TAG NAME</label>
          <%= f.text_field :name, required: true,
              class: "w-full border border-base-content/20 bg-base-100 px-3 py-2 text-xs focus:border-primary focus:outline-none",
              placeholder: "e.g., VIP, Monthly Donor, Prayer Warrior" %>
        </div>
        <%= f.submit "CREATE TAG",
            class: "bg-primary text-primary-content hover:bg-primary/80 px-4 py-2 text-[10px] sm:text-xs font-bold transition-colors cursor-pointer" %>
      <% end %>

      <% if @tag.errors.any? %>
        <div class="mt-3 bg-error/10 border border-error/30 p-3">
          <ul class="text-[10px] text-error space-y-1">
            <% @tag.errors.full_messages.each do |message| %>
              <li>- <%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Tags List -->
  <% if @tags.any? %>
    <div class="border border-base-content/20">
      <div class="bg-base-content/5 p-3 border-b border-base-content/20">
        <div class="grid grid-cols-12 gap-4 text-[10px] font-bold text-base-content/60">
          <div class="col-span-5">TAG NAME</div>
          <div class="col-span-3">SUBSCRIBERS</div>
          <div class="col-span-2">NEWSLETTERS</div>
          <div class="col-span-2">ACTIONS</div>
        </div>
      </div>
      <div class="divide-y divide-base-content/10">
        <% @tags.each do |tag| %>
          <div class="p-3 hover:bg-base-200 transition-colors">
            <div class="grid grid-cols-12 gap-4 items-center">
              <div class="col-span-5">
                <span class="bg-base-content/10 px-2 py-1 text-xs font-bold"><%= tag.name.upcase %></span>
              </div>
              <div class="col-span-3 text-xs text-base-content/80">
                <%= tag.subscribers.confirmed.count %> confirmed
              </div>
              <div class="col-span-2 text-xs text-base-content/80">
                <%= tag.newsletters.count %> sent
              </div>
              <div class="col-span-2 flex items-center gap-2">
                <%= link_to "VIEW", subscribers_path(tag: tag.id),
                    class: "text-[10px] text-primary hover:underline font-bold" %>
                <%= button_to "DELETE", tag_path(tag), method: :delete,
                    form: { class: "inline" },
                    data: { turbo_confirm: "Delete tag '#{tag.name}'? Subscribers will not be deleted." },
                    class: "text-[10px] text-error hover:underline font-bold cursor-pointer" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="border border-base-content/20 p-8 text-center">
      <div class="text-base-content/40 mb-4">
        <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
        </svg>
      </div>
      <div class="text-sm font-bold mb-2">NO TAGS YET</div>
      <p class="text-[10px] text-base-content/60">Create tags to organize your subscribers and target your newsletters.</p>
    </div>
  <% end %>

  <!-- Info Box -->
  <div class="mt-6 border border-info/30 bg-info/10 p-4">
    <div class="text-[10px] text-info font-bold mb-2">HOW TAGS WORK</div>
    <ul class="text-[10px] text-base-content/80 space-y-1">
      <li>- Assign tags to subscribers to organize your list</li>
      <li>- When sending a newsletter, select tags to target specific groups</li>
      <li>- Subscribers can have multiple tags</li>
      <li>- Deleting a tag does not delete the subscribers</li>
    </ul>
  </div>
</div>
