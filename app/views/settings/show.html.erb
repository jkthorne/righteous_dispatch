<% content_for :title, "Settings - RighteousDispatch" %>

<div class="max-w-lg mx-auto">
  <div class="mb-6">
    <h1 class="text-lg sm:text-xl font-bold">SETTINGS</h1>
    <p class="text-[10px] sm:text-xs text-base-content/60 mt-1">Manage your account settings</p>
  </div>

  <!-- Profile Section -->
  <div class="border border-base-content/20 mb-4">
    <div class="bg-base-content/5 p-3 border-b border-base-content/20">
      <div class="text-[10px] sm:text-xs font-bold">PROFILE</div>
    </div>
    <div class="p-4 sm:p-6">
      <%= form_with model: current_user, url: settings_path, method: :patch, class: "space-y-4" do |f| %>
        <% if current_user.errors[:name].any? || current_user.errors[:email].any? %>
          <div class="bg-error/10 border border-error/30 p-3">
            <div class="text-[10px] text-error font-bold mb-2">PLEASE FIX THE FOLLOWING ERRORS:</div>
            <ul class="text-[10px] text-error space-y-1">
              <% current_user.errors.full_messages.each do |message| %>
                <li>- <%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div>
          <label class="text-[10px] text-base-content/60 mb-1 block font-bold">NAME</label>
          <%= f.text_field :name, required: true,
              class: "w-full border border-base-content/20 bg-base-100 px-3 py-2 text-xs focus:border-primary focus:outline-none" %>
        </div>

        <div>
          <label class="text-[10px] text-base-content/60 mb-1 block font-bold">EMAIL</label>
          <%= f.email_field :email, required: true,
              class: "w-full border border-base-content/20 bg-base-100 px-3 py-2 text-xs focus:border-primary focus:outline-none" %>
        </div>

        <div class="pt-2">
          <%= f.submit "SAVE PROFILE",
              class: "bg-primary text-primary-content hover:bg-primary/80 px-4 py-2 text-[10px] sm:text-xs font-bold transition-colors cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Password Section -->
  <div class="border border-base-content/20 mb-4">
    <div class="bg-base-content/5 p-3 border-b border-base-content/20">
      <div class="text-[10px] sm:text-xs font-bold">CHANGE PASSWORD</div>
    </div>
    <div class="p-4 sm:p-6">
      <%= form_with url: settings_password_path, method: :patch, class: "space-y-4" do |f| %>
        <% if current_user.errors[:current_password].any? || current_user.errors[:password].any? %>
          <div class="bg-error/10 border border-error/30 p-3">
            <div class="text-[10px] text-error font-bold mb-2">PLEASE FIX THE FOLLOWING ERRORS:</div>
            <ul class="text-[10px] text-error space-y-1">
              <% current_user.errors.full_messages.each do |message| %>
                <li>- <%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div>
          <label class="text-[10px] text-base-content/60 mb-1 block font-bold">CURRENT PASSWORD</label>
          <%= f.password_field :current_password, required: true,
              class: "w-full border border-base-content/20 bg-base-100 px-3 py-2 text-xs focus:border-primary focus:outline-none" %>
        </div>

        <div>
          <label class="text-[10px] text-base-content/60 mb-1 block font-bold">NEW PASSWORD</label>
          <%= f.password_field "user[password]", required: true,
              class: "w-full border border-base-content/20 bg-base-100 px-3 py-2 text-xs focus:border-primary focus:outline-none" %>
        </div>

        <div>
          <label class="text-[10px] text-base-content/60 mb-1 block font-bold">CONFIRM NEW PASSWORD</label>
          <%= f.password_field "user[password_confirmation]", required: true,
              class: "w-full border border-base-content/20 bg-base-100 px-3 py-2 text-xs focus:border-primary focus:outline-none" %>
        </div>

        <div class="pt-2">
          <%= f.submit "CHANGE PASSWORD",
              class: "bg-primary text-primary-content hover:bg-primary/80 px-4 py-2 text-[10px] sm:text-xs font-bold transition-colors cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Account Info -->
  <div class="border border-base-content/20 mb-4">
    <div class="bg-base-content/5 p-3 border-b border-base-content/20">
      <div class="text-[10px] sm:text-xs font-bold">ACCOUNT INFO</div>
    </div>
    <div class="p-4 space-y-3">
      <div>
        <div class="text-[10px] text-base-content/60">MEMBER SINCE</div>
        <div class="text-xs font-bold"><%= current_user.created_at.strftime("%B %d, %Y") %></div>
      </div>
      <div>
        <div class="text-[10px] text-base-content/60">NEWSLETTERS</div>
        <div class="text-xs font-bold"><%= current_user.newsletters.count %></div>
      </div>
      <div>
        <div class="text-[10px] text-base-content/60">SUBSCRIBERS</div>
        <div class="text-xs font-bold"><%= current_user.subscribers.count %></div>
      </div>
    </div>
  </div>

  <!-- Danger Zone -->
  <div class="border border-error/30 mb-4">
    <div class="bg-error/10 p-3 border-b border-error/30">
      <div class="text-[10px] sm:text-xs font-bold text-error">DANGER ZONE</div>
    </div>
    <div class="p-4 sm:p-6">
      <p class="text-[10px] text-base-content/60 mb-4">
        Deleting your account will permanently remove all your newsletters, subscribers, and data. This action cannot be undone.
      </p>
      <%= form_with url: settings_path, method: :delete, class: "space-y-4",
          data: { turbo_confirm: "Are you ABSOLUTELY sure? This will delete ALL your data permanently." } do |f| %>
        <div>
          <label class="text-[10px] text-base-content/60 mb-1 block font-bold">ENTER YOUR PASSWORD TO CONFIRM</label>
          <%= f.password_field :password, required: true,
              class: "w-full border border-error/30 bg-base-100 px-3 py-2 text-xs focus:border-error focus:outline-none" %>
        </div>
        <div class="pt-2">
          <%= f.submit "DELETE MY ACCOUNT",
              class: "bg-error/10 hover:bg-error/20 border border-error/30 text-error px-4 py-2 text-[10px] sm:text-xs font-bold transition-colors cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
